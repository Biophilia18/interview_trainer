{% extends "base.html" %}
{% block content %}
  <h2>学习统计</h2>

  <p>今日复习：{{ stats.today_reviews or 0 }} 题</p>

  {# 如果后端返回了时间统计就显示，否则只显示题数统计 #}
  {% if stats.total_seconds_today is defined %}
    <p>今日总用时：{{ stats.total_seconds_today or 0 }} 秒</p>
  {% endif %}
  {% if stats.avg_seconds_all is defined %}
    <p>历史平均用时：{{ stats.avg_seconds_all|float|round(1) }} 秒</p>
  {% endif %}

  <h3>掌握程度（题目数）</h3>
  <ul class="stats__list">
    {% if stats.level_stats %}
      {% for level, count in stats.level_stats.items() %}
        <li>等级 {{ level }}: {{ count }} 题</li>
      {% endfor %}
    {% else %}
      <li>暂无掌握层级数据</li>
    {% endif %}
  </ul>

  <h3>按分类</h3>
  <ul>
    {% if stats.category_stats %}
      {% for cat, data in stats.category_stats.items() %}
        {% if data is mapping %}
          <li>
            {{ cat or '未分类' }} — 题数: {{ data.count }}；
            总用时: {{ data.total_seconds }}s；
            平均用时: {{ data.avg_seconds|float|round(1) }}s
          </li>
        {% else %}
          <li>{{ cat or '未分类' }} — 题数: {{ data }} 题</li>
        {% endif %}
      {% endfor %}
    {% else %}
      <li>暂无分类数据</li>
    {% endif %}
  </ul>

  <h3>按难度</h3>
  <ul>
    {% if stats.difficulty_stats %}
      {% for diff, data in stats.difficulty_stats.items() %}
        {% if data is mapping %}
          <li>
            {{ diff or '未设定' }} — 题数: {{ data.count }}；
            总用时: {{ data.total_seconds }}s；
            平均用时: {{ data.avg_seconds|float|round(1) }}s
          </li>
        {% else %}
          <li>{{ diff or '未设定' }} — 题数: {{ data }} 题</li>
        {% endif %}
      {% endfor %}
    {% else %}
      <li>暂无难度数据</li>
    {% endif %}
  </ul>

  {# 可选：展示快速查询链接或导出按钮（不必要，按需开启） #}
  <div style="margin-top:16px;">
    <a class="button" href="{{ url_for('index') }}">继续答题</a>
  </div>
{% endblock %}
